user nginx;

# Events context defines global connection processing settings
events {
    # Maximum number of simultaneous connections
    worker_connections 1000;
}

# HTTP context contains all HTTP-related directives
http {
    # Timeout settings to prevent hanging connections
    # Time to establish a connection with the upstream server
    proxy_connect_timeout 300;
    # Time to wait for data during sending to upstream
    proxy_send_timeout 300;
    # Time to wait for data during reading from upstream
    proxy_read_timeout 300;
    # Time to wait for client to accept response
    send_timeout 300;

    # Enable application/json content type
    include /etc/nginx/mime.types;
    default_type application/json;

    # Buffer settings for smoother data transfer
    proxy_buffers 16 32k;
    proxy_buffer_size 32k;

    # Server context defines settings for virtual hosts
    server {
        # Listen on port 80
        listen 80;
        access_log off;

        # Dashboard UI - Root location
        location / {
            proxy_pass http://dashboard:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Receiver service
        location /receiver {
            proxy_pass http://receiver:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Storage service
        location /storage {
            proxy_pass http://storage:8090;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Processing service
        location /processing {
            proxy_pass http://processing:8100;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Analyzer service
        location /analyzer {
            proxy_pass http://analyzer:8110;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Anomaly detector service
        location /anomaly {
            proxy_pass http://anomaly-detector:8120;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}